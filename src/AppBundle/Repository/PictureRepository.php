<?php

namespace AppBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * PictureRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PictureRepository extends EntityRepository {
    public function getActivePicturesFromCategory( $id ) {
        return $this->createQueryBuilder( 'p' )
                    ->innerJoin( 'p.categories', 'c' )// Inner Join with users
                    ->innerJoin( 'p.form', 'f' )// Inner Join with users
                    ->where( 'c.id = :category' )
                    ->andWhere( 'p.isActive = true' )
                    ->setParameter( 'category', $id );
    }

    public function findLastVisited( $ids ) {

        return $this->createQueryBuilder( 'p' )
                    ->where( 'p.id IN (:ids)' )
                    ->setParameter( 'ids', $ids )
                    ->getQuery()
                    ->getResult();
    }

    public function getActiveSimilar( $id ) {
        $entities = $this->createQueryBuilder( 'p' )
                         ->innerJoin( 'p.similar', 's' )// Inner Join with similar
                         ->where( 'p.id = :id' )
                         ->andWhere( 'p.isActive = true' )
                         ->andWhere( 's.isActive = true' )
                         ->setParameter( 'id', $id )
                         ->getQuery()
                         ->getResult();

        if ( count( $entities ) > 0 ) {
            return $entities[0]->getSimilar();
        }

        return [ ];
    }
}
